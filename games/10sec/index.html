<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>10ç§’ãƒãƒ£ãƒ¬ãƒ³ã‚¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #e9eef8;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    .container {
      background: #fff;
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      text-align: center;
      width: 300px;
    }
    h1 {
      margin: 0 0 16px;
      font-size: 1.2rem;
    }
    .time {
      font-size: 2rem;
      margin: 16px 0;
      min-height: 2.2rem;
      color: #333;
    }
    button {
      width: 100%;
      padding: 12px 0;
      font-size: 1rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 8px;
      transition: 0.1s;
      color: white;
      background: #4b6fff;
      touch-action: manipulation; /* ã‚¿ãƒƒãƒ—æ™‚ã®ä½™è¨ˆãªé…å»¶ã‚’æ¸›ã‚‰ã™ãƒ’ãƒ³ãƒˆ */
    }
    button:active {
      transform: translateY(1px);
    }
    .result {
      margin-top: 12px;
      font-size: 1rem;
      min-height: 1.2rem;
    }
    .hiscore {
      margin-top: 10px;
      font-size: 0.95rem;
      color: #444;
      background: #f4f7ff;
      border-radius: 10px;
      padding: 10px 12px;
      text-align: left;
      line-height: 1.35;
    }
    .hiscore b { color: #2a46c6; }
  </style>
</head>
<body>

<div class="container">
  <h1>10ç§’ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h1>

  <div id="time" class="time">ã€€</div>

  <button id="mainBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>

  <div id="result" class="result"></div>

  <div id="hiscore" class="hiscore"></div>
  <button id="resetBtn" style="background:#8892a6;">ãƒã‚¤ã‚¹ã‚³ã‚¢ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
</div>

<script>
  let startTime = null;
  let isRunning = false;

  const timeDisplay = document.getElementById('time');
  const resultDisplay = document.getElementById('result');
  const mainBtn = document.getElementById('mainBtn');
  const hiscoreDisplay = document.getElementById('hiscore');
  const resetBtn = document.getElementById('resetBtn');

  // ---- ãƒã‚¤ã‚¹ã‚³ã‚¢ï¼ˆæœ€å°èª¤å·®ï¼‰ä¿å­˜ã‚­ãƒ¼ ----
  const HS_KEY = "tenSecChallenge_highscore_v1";

  function loadHighScore() {
    try {
      const raw = localStorage.getItem(HS_KEY);
      if (!raw) return null;
      const obj = JSON.parse(raw);
      if (typeof obj?.bestDiff !== "number" || typeof obj?.bestElapsed !== "number") return null;
      if (typeof obj?.updatedAt !== "number") obj.updatedAt = Date.now();
      return obj;
    } catch {
      return null;
    }
  }

  function saveHighScore(hs) {
    localStorage.setItem(HS_KEY, JSON.stringify(hs));
  }

  function formatDate(ts) {
    const d = new Date(ts);
    const y = d.getFullYear();
    const m = String(d.getMonth() + 1).padStart(2, "0");
    const day = String(d.getDate()).padStart(2, "0");
    const hh = String(d.getHours()).padStart(2, "0");
    const mm = String(d.getMinutes()).padStart(2, "0");
    return `${y}/${m}/${day} ${hh}:${mm}`;
  }

  function renderHighScore(hs) {
    if (!hs) {
      hiscoreDisplay.innerHTML = `ãƒã‚¤ã‚¹ã‚³ã‚¢ï¼š<b>æœªç™»éŒ²</b><br>ï¼ˆèª¤å·®ãŒä¸€ç•ªå°ã•ã„è¨˜éŒ²ãŒä¿å­˜ã•ã‚Œã¾ã™ï¼‰`;
      return;
    }
    hiscoreDisplay.innerHTML =
      `ãƒã‚¤ã‚¹ã‚³ã‚¢ï¼šèª¤å·® <b>${hs.bestDiff.toFixed(3)} ç§’</b><br>` +
      `è¨˜éŒ²ï¼š${hs.bestElapsed.toFixed(3)} ç§’<br>` +
      `æ›´æ–°ï¼š${formatDate(hs.updatedAt)}`;
  }

  // åˆæœŸè¡¨ç¤º
  let highScore = loadHighScore();
  renderHighScore(highScore);

  function isNewRecord(diff, elapsed, hs) {
    if (!hs) return true;
    // diff ãŒå°ã•ã„ã»ã©è‰¯ã„ã€‚å®Œå…¨åŒç‚¹ãªã‚‰ã€elapsedãŒ10ã«è¿‘ã„ã®ã¯åŒã˜ãªã®ã§
    // ã“ã“ã§ã¯ã€Œã‚ˆã‚Šæ—©ã„æ›´æ–°ï¼ˆelapsedãŒå°ã•ã„æ–¹ï¼‰ã€ã‚’å„ªå…ˆï¼ˆå¥½ã¿ã§å¤‰ãˆã¦OKï¼‰
    if (diff < hs.bestDiff - 1e-9) return true;
    if (Math.abs(diff - hs.bestDiff) <= 1e-9 && elapsed < hs.bestElapsed - 1e-9) return true;
    return false;
  }

  function handlePress(event) {
    // é•·æŠ¼ã—ãªã©ã§è¤‡æ•°ã‚¤ãƒ™ãƒ³ãƒˆãŒå…¥ã‚‰ãªã„ã‚ˆã†ä¸€å¿œåˆ¶å¾¡
    if (event.pointerType === 'mouse' || event.pointerType === 'touch' || event.pointerType === 'pen') {
      event.preventDefault();
    }

    // --- è¨ˆæ¸¬é–‹å§‹ ---
    if (!isRunning) {
      startTime = performance.now();
      isRunning = true;

      resultDisplay.textContent = "";
      timeDisplay.textContent = "è¨ˆæ¸¬ä¸­â€¦";

      mainBtn.textContent = "ã‚¹ãƒˆãƒƒãƒ—";
      mainBtn.style.background = "#ff6b6b";
      return;
    }

    // --- è¨ˆæ¸¬åœæ­¢ ---
    const end = performance.now();
    isRunning = false;

    const elapsed = (end - startTime) / 1000;
    const diff = Math.abs(elapsed - 10);

    timeDisplay.textContent = elapsed.toFixed(3) + " ç§’";
    resultDisplay.textContent = `èª¤å·®ï¼š${diff.toFixed(3)} ç§’`;

    // --- ãƒã‚¤ã‚¹ã‚³ã‚¢åˆ¤å®š ---
    if (isNewRecord(diff, elapsed, highScore)) {
      highScore = {
        bestDiff: diff,
        bestElapsed: elapsed,
        updatedAt: Date.now()
      };
      saveHighScore(highScore);
      renderHighScore(highScore);
      resultDisplay.textContent += "ï¼ˆğŸ‰ æ–°è¨˜éŒ²ï¼‰";
    }

    mainBtn.textContent = "ã‚¹ã‚¿ãƒ¼ãƒˆ";
    mainBtn.style.background = "#4b6fff";
  }

  // ã‚¯ãƒªãƒƒã‚¯ã§ã¯ãªã pointerdown ã‚’åˆ©ç”¨ã—ã¦ãƒ©ã‚°ã‚’æ¸›ã‚‰ã™
  mainBtn.addEventListener('pointerdown', handlePress);

  // ãƒã‚¤ã‚¹ã‚³ã‚¢ãƒªã‚»ãƒƒãƒˆ
  resetBtn.addEventListener('pointerdown', (e) => {
    e.preventDefault();
    localStorage.removeItem(HS_KEY);
    highScore = null;
    renderHighScore(highScore);
    resultDisplay.textContent = "ãƒã‚¤ã‚¹ã‚³ã‚¢ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ";
  });
</script>

</body>
    </html>
